üì• 1. DataLoader ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
–ß–∏—Ç–∞–µ—Ç Excel-—Ñ–∞–π–ª —Å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –∞–∫—Ü–∏–π

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —á–∏—Å–ª–∞ (—Å —É—á–µ—Ç–æ–º —Ä—É—Å—Å–∫–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

–ö–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî convert_to_float
python
def convert_to_float(value):
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞ "1 234 567 –º–ª–Ω" ‚Üí 1234567000000
    value = value.replace(" ", "").replace(",", ".")
    if "–º–ª—Ä–¥" in value:
        return float(re.sub(r"[^\d.]", "", value)) * 1_000_000_000
    elif "–º–ª–Ω" in value:
        return float(re.sub(r"[^\d.]", "", value)) * 1_000_000
–ü–æ—á–µ–º—É —Ç–∞–∫: –†–æ—Å—Å–∏–π—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã —á–∞—Å—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç —á–∏—Å–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "1 234 –º–ª–Ω" ‚Äî –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å—Ç—ã–µ —á–∏—Å–ª–∞.

üìä 2. MarketAnalyzer ‚Äî –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞
2.1 –†–∞—Å—á–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã—Ö –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
python
@dataclass
class MarketBenchmarks:
    pe_median: float      # –ú–µ–¥–∏–∞–Ω–Ω—ã–π P/E –ø–æ —Ä—ã–Ω–∫—É
    pb_median: float      # –ú–µ–¥–∏–∞–Ω–Ω—ã–π P/B –ø–æ —Ä—ã–Ω–∫—É
    ps_median: float      # –ú–µ–¥–∏–∞–Ω–Ω—ã–π P/S –ø–æ —Ä—ã–Ω–∫—É
    roe_median: float     # –ú–µ–¥–∏–∞–Ω–Ω–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
    div_yield_median: float # –ú–µ–¥–∏–∞–Ω–Ω–∞—è –¥–∏–≤–∏–¥–µ–Ω–¥–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    debt_capital_median: float # –ú–µ–¥–∏–∞–Ω–Ω—ã–π –¥–æ–ª–≥/–∫–∞–ø–∏—Ç–∞–ª
    beta_median: float    # –ú–µ–¥–∏–∞–Ω–Ω–∞—è –±–µ—Ç–∞
–ó–∞—á–µ–º: –ß—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è "–¥–æ—Ä–æ–≥–æ" –∏–ª–∏ "–¥–µ—à–µ–≤–æ" –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä—ã–Ω–∫–∞.

2.2 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ–∫—Ç–æ—Ä–∞
python
def assign_sector(name: str) -> str:
    name = name.lower()
    if any(word in name for word in SECTOR_KEYWORDS.BANKS):
        return "–ë–∞–Ω–∫–∏"
    elif any(word in name for word in SECTOR_KEYWORDS.OIL_GAS):
        return "–ù–µ—Ñ—Ç–µ–≥–∞–∑"
    # ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
–õ–æ–≥–∏–∫–∞: –ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç—Ä–∞—Å–ª—å –∫–æ–º–ø–∞–Ω–∏–∏.

2.3 –û—Ü–µ–Ω–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ ‚Äî –Ø–î–†–û –ê–ù–ê–õ–ò–ó–ê
–ö–∞–∂–¥–∞—è –∞–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç —Å–∫–æ—Ä –ø–æ 5 –º–µ—Ç—Ä–∏–∫–∞–º:

python
def calculate_relative_valuation(row, benchmarks):
    scores = {}
    
    # P/E —Å–∫–æ—Ä
    if pe < benchmarks.pe_median * 0.5 ‚Üí scores['pe_score'] = 2 (STRONG_BUY)
    if pe < benchmarks.pe_median * 0.8 ‚Üí scores['pe_score'] = 1 (BUY)
    if pe > benchmarks.pe_median * 1.2 ‚Üí scores['pe_score'] = -1 (SELL)
    else ‚Üí scores['pe_score'] = 0 (HOLD)
    
    # P/S —Å–∫–æ—Ä (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)
    # P/B —Å–∫–æ—Ä
    # ROE —Å–∫–æ—Ä
    # –î–∏–≤–∏–¥–µ–Ω–¥–Ω—ã–π —Å–∫–æ—Ä
    
    total_score = sum(scores.values())
    
    if total_score >= 4 ‚Üí "–°–∏–ª—å–Ω–æ –Ω–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–∞"
    if total_score >= 2 ‚Üí "–ù–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–∞"  
    if total_score <= -2 ‚Üí "–ü–µ—Ä–µ–æ—Ü–µ–Ω–µ–Ω–∞"
    else ‚Üí "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å"
–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏: –ö–∞–∂–¥—ã–π –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å —Ä—ã–Ω–æ—á–Ω–æ–π –º–µ–¥–∏–∞–Ω–æ–π –∏ –¥–∞–µ—Ç –≤–∫–ª–∞–¥ -1, 0, 1 –∏–ª–∏ 2. –°—É–º–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É.

üå≥ 3. DecisionTreeModel ‚Äî –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
3.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
python
feature_columns = [
    "P/E", "P/B", "P/S", "P/FCF",  # –ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    "ROE", "ROA",                   # –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
    "Averange_dividend_yield",      # –î–∏–≤–∏–¥–µ–Ω–¥—ã
    "–ë–µ—Ç–∞",                         # –†—ã–Ω–æ—á–Ω—ã–π —Ä–∏—Å–∫
    "Debt/Capital",                  # –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä—ã—á–∞–≥
    "NPM",                           # –ß–∏—Å—Ç–∞—è –º–∞—Ä–∂–∞
    "–°–µ–∫—Ç–æ—Ä_encoded"                 # –û—Ç—Ä–∞—Å–ª—å (–∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞)
]
3.2 –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
python
def _assign_target(row):
    # –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    if pe < 8 and pb < 0.8 and roe > 0.15:
        return 2  # STRONG_UNDERVALUED
    elif pe < 12 and pb < 1.2 and roe > 0.1:
        return 1  # UNDERVALUED
    elif pe > 20 or pb > 2.5:
        return -1 # OVERVALUED
    else:
        return 0  # FAIR_VALUE
–ü–æ—á–µ–º—É: –ú—ã —Å–æ–∑–¥–∞–µ–º —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–≤—Ä–∏—Å—Ç–∏–∫, —á—Ç–æ–±—ã –æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å.

3.3 –î–µ—Ä–µ–≤–æ —Ä–µ—à–µ–Ω–∏–π ‚Äî –∫–∞–∫ –æ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
python
model = DecisionTreeClassifier(
    max_depth=5,           # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è)
    min_samples_split=10,  # –ú–∏–Ω–∏–º—É–º –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    min_samples_leaf=5,    # –ú–∏–Ω–∏–º—É–º –≤—ã–±–æ—Ä–∫–∏ –≤ –ª–∏—Å—Ç–µ
)
–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞:

text
1. –ù–∞—á–∏–Ω–∞–µ–º —Å –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞ (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ)
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ –∏—â–µ–º –ª—É—á—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:
   - –ü—Ä–æ–±—É–µ–º –ø–æ—Ä–æ–≥: P/E < 12
   - –°—á–∏—Ç–∞–µ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å (–ø—Ä–∏–º–µ—Å—å –î–∂–∏–Ω–∏)
3. –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–∑–Ω–∞–∫ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —É–º–µ–Ω—å—à–µ–Ω–∏–µ–º –ø—Ä–∏–º–µ—Å–∏
4. –°–æ–∑–¥–∞–µ–º –ª–µ–≤—ã–π –∏ –ø—Ä–∞–≤—ã–π –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã
5. –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ–≤—Ç–æ—Ä—è–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞, –ø–æ–∫–∞:
   - –ù–µ –¥–æ—Å—Ç–∏–≥–Ω–µ–º max_depth
   - –ò–ª–∏ –≤ —É–∑–ª–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ samples
   - –ò–ª–∏ –≤—Å–µ –æ–±—Ä–∞–∑—Ü—ã –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
–§–æ—Ä–º—É–ª–∞ –ø—Ä–∏–º–µ—Å–∏ –î–∂–∏–Ω–∏:
G
i
n
i
=
1
‚àí
‚àë
k
=
1
K
p
k
2
Gini=1‚àí‚àë 
k=1
K
‚Äã
 p 
k
2
‚Äã
 

–ì–¥–µ $p_k$ ‚Äî –¥–æ–ª—è –∫–ª–∞—Å—Å–∞ k –≤ —É–∑–ª–µ.

3.4 –í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
python
feature_importance = model.feature_importances_
–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å—É–º–º–∞—Ä–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Å–∏, –∫–æ—Ç–æ—Ä–æ–µ –¥–∞–ª –ø—Ä–∏–∑–Ω–∞–∫ –Ω–∞ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è—Ö.

üìâ 4. FundamentalAnalyzer ‚Äî —Ä–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–∞
4.1 –†–∞—Å—á–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
–ë–∞–∑–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å = 8% + –ø—Ä–µ–º–∏–∏ –∑–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:

–§–∞–∫—Ç–æ—Ä	–ü—Ä–µ–º–∏—è	–£—Å–ª–æ–≤–∏–µ
–°–∏–ª—å–Ω–æ –Ω–∏–∑–∫–∏–π P/E	+3%	P/E < –º–µ–¥–∏–∞–Ω—ã√ó0.5
–ù–∏–∑–∫–∏–π P/E	+1.5%	P/E < –º–µ–¥–∏–∞–Ω—ã√ó0.8
–°–∏–ª—å–Ω–æ –Ω–∏–∑–∫–∏–π P/S	+2%	P/S < –º–µ–¥–∏–∞–Ω—ã√ó0.5
–ù–∏–∑–∫–∏–π P/S	+1%	P/S < –º–µ–¥–∏–∞–Ω—ã√ó0.8
–°–∏–ª—å–Ω–æ –Ω–∏–∑–∫–∏–π P/B	+2%	P/B < –º–µ–¥–∏–∞–Ω—ã√ó0.7 –∏ ROE > 0
–í—ã—Å–æ–∫–∏–π ROE	+2%	ROE > –º–µ–¥–∏–∞–Ω—ã√ó1.5
–í—ã—Å–æ–∫–∞—è –¥–∏–≤. –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å	+2%	–î–∏–≤. > –º–µ–¥–∏–∞–Ω—ã√ó1.5
–û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ "–°–∏–ª—å–Ω–æ –Ω–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–∞"	+2%	–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ = 2
–û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ "–ù–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–∞"	+1%	–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ = 1
–ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞:
E
x
p
e
c
t
e
d
R
e
t
u
r
n
=
0.08
+
‚àë
i
p
r
e
m
i
u
m
i
ExpectedReturn=0.08+‚àë 
i
‚Äã
 premium 
i
‚Äã
 

4.2 –†–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞
–ë–∞–∑–æ–≤–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å = 20% + –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏:

–§–∞–∫—Ç–æ—Ä	–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
–í—ã—Å–æ–∫–∞—è –±–µ—Ç–∞ (>1.2√ó–º–µ–¥–∏–∞–Ω—ã)	+5%
–°—Ä–µ–¥–Ω—è—è –±–µ—Ç–∞ (>1.0√ó–º–µ–¥–∏–∞–Ω—ã)	+2%
–ù–∏–∑–∫–∞—è –±–µ—Ç–∞ (<0.8√ó–º–µ–¥–∏–∞–Ω—ã)	-2%
–í—ã—Å–æ–∫–∏–π –¥–æ–ª–≥ (>1.5√ó–º–µ–¥–∏–∞–Ω—ã)	+4%
–°—Ä–µ–¥–Ω–∏–π –¥–æ–ª–≥ (>1.2√ó–º–µ–¥–∏–∞–Ω—ã)	+2%
–ü–µ—Ä–µ–æ—Ü–µ–Ω–µ–Ω–∞ –º–æ–¥–µ–ª—å—é	+5%
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: —Ä–∏—Å–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∏–∂–µ 12% –∏ –≤—ã—à–µ 40%.

üìê 5. PortfolioOptimizer ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ –ú–∞—Ä–∫–æ–≤–∏—Ü—É
5.1 –ú–∞—Ç—Ä–∏—Ü–∞ –∫–æ–≤–∞—Ä–∏–∞—Ü–∏–∏
python
def create_covariance_matrix(self, df):
    n = len(df)
    cov_matrix = np.zeros((n, n))
    risks = df["–†–∏—Å–∫"].values
    
    for i in range(n):
        for j in range(n):
            if i == j:
                cov_matrix[i, j] = risks[i] ** 2  # –î–∏—Å–ø–µ—Ä—Å–∏—è
            else:
                # –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ–∫—Ç–æ—Ä–∞
                if df.iloc[i]["–°–µ–∫—Ç–æ—Ä"] == df.iloc[j]["–°–µ–∫—Ç–æ—Ä"]:
                    corr = 0.5  # –í–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ç–æ—Ä–∞
                else:
                    corr = 0.2  # –ú–µ–∂–¥—É —Å–µ–∫—Ç–æ—Ä–∞–º–∏
                cov_matrix[i, j] = corr * risks[i] * risks[j]
–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏: –ö–æ–≤–∞—Ä–∏–∞—Ü–∏—è = –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è √ó —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ‚ÇÅ √ó —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ‚ÇÇ

5.2 –¶–µ–ª–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è –®–∞—Ä–ø–∞
python
def neg_sharpe(weights):
    port_return = np.sum(expected_returns * weights)
    port_risk = np.sqrt(np.dot(weights.T, np.dot(cov_matrix, weights)))
    return -port_return / port_risk  # –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –®–∞—Ä–ø
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: 
S
h
a
r
p
e
=
R
p
‚àí
R
f
œÉ
p
Sharpe= 
œÉ 
p
‚Äã
 
R 
p
‚Äã
 ‚àíR 
f
‚Äã
 
‚Äã
  (–±–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –∑–∞ 0)

5.3 –¢—Ä–∏ —Ç–∏–ø–∞ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π
python
# 1. –ú–∞–∫—Å–∏–º—É–º –®–∞—Ä–ø–∞
result_sharpe = minimize(neg_sharpe, ...)

# 2. –ú–∏–Ω–∏–º—É–º —Ä–∏—Å–∫–∞
result_min_risk = minimize(portfolio_risk, ...)

# 3. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (60% max Sharpe + 40% min risk)
combined = 0.6 * sharpe_weights + 0.4 * min_risk_weights
–ü–æ—á–µ–º—É –∫–æ–º–±–∏–Ω–∏—Ä—É–µ–º: –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º –∏ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º –ø–æ–¥—Ö–æ–¥–∞–º–∏.

üíº 6. PortfolioManager ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º
6.1 –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è
python
class PortfolioMetrics:
    expected_return: float  # ‚àë w_i * r_i
    risk: float             # ‚àö(w^T Œ£ w)
    sharpe_ratio: float     # return / risk
    diversification_score: float  # 1 - (HHI - 1/n)/(1 - 1/n)
6.2 –ò–Ω–¥–µ–∫—Å –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –•–µ—Ä—Ñ–∏–Ω–¥–∞–ª—è-–•–∏—Ä—à–º–∞–Ω–∞
H
H
I
=
‚àë
w
i
2
HHI=‚àëw 
i
2
‚Äã
 

HHI = 1 ‚Üí –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω (–æ–¥–Ω–∞ –∞–∫—Ü–∏—è)

HHI = 1/n ‚Üí –∏–¥–µ–∞–ª—å–Ω–æ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω

–ò–Ω–¥–µ–∫—Å –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:
D
i
v
=
1
‚àí
H
H
I
‚àí
1
/
n
1
‚àí
1
/
n
Div=1‚àí 
1‚àí1/n
HHI‚àí1/n
‚Äã
 

Div = 1 ‚Üí –∏–¥–µ–∞–ª—å–Ω–∞—è –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

Div = 0 ‚Üí –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è

üé® 7. PortfolioVisualizer ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
7.1 –ß–µ—Ç—ã—Ä–µ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –æ–¥–Ω–æ–º
text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Pie chart     ‚îÇ  Risk-Return    ‚îÇ
‚îÇ   –¢–æ–ø –ø–æ–∑–∏—Ü–∏–π   ‚îÇ  scatter plot   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Pie chart     ‚îÇ  –¢–µ–∫—Å—Ç —Å        ‚îÇ
‚îÇ   –°–µ–∫—Ç–æ—Ä–∞       ‚îÇ  –º–µ—Ç—Ä–∏–∫–∞–º–∏      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
7.2 –ì—Ä–∞–Ω–∏—Ü–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 10,000 —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

–ö–∞–∂–¥–∞—è —Ç–æ—á–∫–∞ ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å

–¶–≤–µ—Ç ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞

–ó–≤–µ–∑–¥–∞ ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å

üìÑ 8. ReportGenerator ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
–°–æ–∑–¥–∞–µ—Ç Excel-—Ñ–∞–π–ª —Å 5 –ª–∏—Å—Ç–∞–º–∏:

Portfolio ‚Äî —Å–æ—Å—Ç–∞–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è —Å –≤–µ—Å–∞–º–∏

Sectors ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º

Metrics ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è

Benchmarks ‚Äî —Ä—ã–Ω–æ—á–Ω—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏

Recommendations ‚Äî –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

üèÜ 9. MultiplierAnalyzer ‚Äî –∞–Ω–∞–ª–∏–∑ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–æ–≤
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä—ã–Ω–∫–∞:

–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º

–õ—É—á—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Ä—ã–Ω–∫–µ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π P/E, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ROE –∏ —Ç.–¥.)

üîÑ 10. –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω ‚Äî –∫–∞–∫ –≤—Å–µ —Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è
python
def main():
    # 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    df = loader.load_and_clean_data()
    
    # 2. –†—ã–Ω–æ—á–Ω—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏
    benchmarks = MarketAnalyzer.calculate_benchmarks(df)
    
    # 3. –û–±—É—á–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π
    dt_model.train(df)
    
    # 4. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ü–∏–π
    df = dt_model.predict(df)
    
    # 5. –†–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–∞
    df["–û–∂–∏–¥–∞–µ–º–∞—è_–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å"] = fundamental_analyzer.calculate_expected_return(df)
    df["–†–∏—Å–∫"] = fundamental_analyzer.calculate_risk(df)
    
    # 6. –û—Ç–±–æ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
    candidates = df[ (–æ—Ü–µ–Ω–∫–∞ –≤ {strong_undervalued, undervalued}) &
                     (–∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è > 50 –º–ª—Ä–¥) &
                     (–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å > 10%) &
                     (—Ä–∏—Å–∫ < 35%) ]
    
    # 7. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è
    cov_matrix = optimizer.create_covariance_matrix(candidates)
    optimal_weights = optimizer.optimize(candidates["–û–∂–∏–¥–∞–µ–º–∞—è_–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å"], cov_matrix)
    
    # 8. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è
    portfolio = PortfolioManager(candidates, optimal_weights)
    
    # 9. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
    visualizer.plot_portfolio_summary(...)
    visualizer.plot_efficient_frontier(...)
    
    # 10. –û—Ç—á–µ—Ç—ã
    report_generator.generate_portfolio_report(...)
    
    return portfolio
üß† –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —Å–∏—Å—Ç–µ–º—ã
–û–±—â–∞—è —Ü–µ–ª–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è:
maxw[‚àëwiriwTŒ£w]
maxw[wTŒ£w‚àëwi ri]

–ü—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö:

$\sum w_i = 1$ (–ø–æ–ª–Ω–æ–µ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

$0.01 \leq w_i \leq 0.15$ (–¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)

$w_i > 0$ (–±–µ–∑ –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø—Ä–æ–¥–∞–∂)

–û—Ü–µ–Ω–∫–∞ –∞–∫—Ü–∏–∏:
Score=‚àëjfj(mij,Mj)
Score=‚àë jfj‚Äã(m ij,M j)
–≥–¥–µ:

$m_{ij}$ ‚Äî –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä j –¥–ª—è –∞–∫—Ü–∏–∏ i

$M_j$ ‚Äî –º–µ–¥–∏–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–∞ j –ø–æ —Ä—ã–Ω–∫—É

$f_j$ ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–¥–∞–µ—Ç -1, 0, 1, 2)

–û–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å:
ri=0.08+‚àëkŒ±k‚ãÖI(—É—Å–ª–æ–≤–∏–µk)r i
‚Äã
 =0.08+‚àë kŒ± k‚ãÖI(—É—Å–ª–æ–≤–∏–µ k)

–≥–¥–µ $I$ ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (1 –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ), $\alpha_k$ ‚Äî –ø—Ä–µ–º–∏—è –∑–∞ —Ñ–∞–∫—Ç–æ—Ä.

–†–∏—Å–∫:
œÉi=0.20+‚àëlŒ≤l‚ãÖI(—É—Å–ª–æ–≤–∏–µl)œÉ i
‚Äã
 =0.20+‚àë lŒ≤ l‚ãÖI(—É—Å–ª–æ–≤–∏–µ l)

—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º $0.12 \leq \sigma_i \leq 0.40$.

üí° –ö–ª—é—á–µ–≤—ã–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ
–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: ML + —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ + –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–∞—è —Ç–µ–æ—Ä–∏—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—á–µ–Ω—ã —ç–≤—Ä–∏—Å—Ç–∏–∫–∞–º–∏, –º–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –Ω–∞ –Ω–∏—Ö

–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏: –ø–æ—Ä–æ–≥–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä—ã–Ω–æ—á–Ω—ã—Ö –º–µ–¥–∏–∞–Ω

–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å: —Å–º–µ—Å—å –º–∞–∫—Å–∏–º—É–º–∞ –®–∞—Ä–ø–∞ –∏ –º–∏–Ω–∏–º—É–º–∞ —Ä–∏—Å–∫–∞

–†–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å: –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ fallback-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

